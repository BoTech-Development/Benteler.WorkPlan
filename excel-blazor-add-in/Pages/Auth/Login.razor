@using Benteler.WorkPlan.Web.Api
@page "/auth/login"
@inject NavigationManager NavigationManager
<MudStack>
	<MudItem>
		<MudText Typo="Typo.h4" Class="pa-4">Login</MudText>
	</MudItem>
	<MudItem>
		<MudPaper Class="pa-4">
			<MudTextField T="string"
						  Label="Email"
						  Variant="Variant.Outlined"
						  Required="true"
						  FullWidth="true" 
						  @bind-Value="Email"/>
			<MudTextField T="string"
						  Label="Password"
						  Variant="Variant.Outlined"
						  Required="true"
						  FullWidth="true"
						  @bind-Value="Password"/>
		</MudPaper>
	</MudItem>
	<MudItem>
		<MudPaper Class="pa-4">
			<MudButton Variant="Variant.Outlined"
					   Color="Color.Secondary"
					   FullWidth="true"
					   >
				Cancel
			</MudButton>
			<MudButton Variant="Variant.Filled"
					   Color="Color.Primary"
					   FullWidth="true"
					   OnClick="@OnLoginClicked">
				Login
			</MudButton>
		</MudPaper>
	</MudItem>
</MudStack>

@code {
	[Parameter]
	[SupplyParameterFromQuery(Name = "lastPage")]
	public string? LastPage { get; set; }

	public string Password { get; set; }
	public string Email { get; set; }

	public async Task OnLoginClicked()
	{
		ApiClient? client = null;
		if ((client = await ApiClient.GetInstance()) != null)
		{
			try
			{
				await client.AuthenticationClient.Login(Email, Password);
				NavigationManager.NavigateTo(LastPage);
			}
			catch(Exception ex)
			{
				Console.WriteLine(ex.Message);
			}
		}
	}
}
